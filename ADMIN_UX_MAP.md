# 어드민 ↔ 사용자 UX 매핑

> 어드민/PM이 하는 **모든 조작**이 사용자 화면에서 **어떻게 보이는지** 1:1 매핑한 문서.
> 새로운 기능 추가 시 반드시 이 문서에 양쪽을 함께 기록할 것.

---

## 전체 플로우 요약

```
사용자 화면                          어드민/PM 조작
─────────────────────────────────────────────────────────
랜딩 페이지                          (관여 없음)
    ↓ "창업비용 확인하기"
온보딩 슬라이드 (4장)                (관여 없음)
    ↓ 스와이프/다음
위자드 1단계: 업종 선택              (관여 없음)
위자드 2단계: 지역 선택              (관여 없음)
위자드 3단계: 상권 분석              (관여 없음)
위자드 4단계: 매장 규모              (관여 없음)
위자드 5단계: 체크리스트             (관여 없음)
위자드 6단계: 비용 산출              (관여 없음)
    ↓ "매니저 배정 신청"
대시보드: 매니저 대기중        ←──  [어드민] PM 배정
대시보드: Step 7 상담 시작     ←──  [어드민] PM 배정 수락
대시보드: Step 8 비용 견적     ←──  [어드민] 단계 변경 7→8
대시보드: Step 9 계약/시작     ←──  [어드민] 단계 변경 8→9
    ↓ 사용자 결제
대시보드: Step 10 시공 진행    ←──  [어드민] 단계 변경 9→10
대시보드: Step 11 오픈 완료    ←──  [어드민] 단계 변경 10→11
대시보드: Step 12 사후관리     ←──  [어드민] 단계 변경 11→12
```

---

## 1. 역할별 접근 권한

| 역할 | 진입 방법 | 볼 수 있는 화면 |
|------|----------|----------------|
| **사용자 (고객)** | 게스트 진입 또는 이메일 회원가입 | 랜딩, 온보딩, 위자드, 대시보드, 채팅, 결제 |
| **PM (담당 매니저)** | 이메일 + `pm1234!` 로그인 | PM 포털 (배정된 프로젝트만) |
| **어드민** | `admin@opening.run` 로그인 | 어드민 패널 (전체 제어) |

---

## 2. 어드민 패널 탭별 매핑

### 2-1. 대시보드 (통계)

| 어드민이 보는 것 | 데이터 소스 | 사용자에게 보이는 영향 |
|----------------|-----------|---------------------|
| 총 고객 수 | `profiles` count | 없음 (어드민 전용) |
| 총 프로젝트 수 | `startup_projects` count | 없음 |
| 활성 PM 수 | `project_managers` (is_available=true) | 없음 |
| 활성 협력업체 수 | `partners` (is_active=true) | 없음 |
| 월 매출 / 총 매출 | `payments` 합산 | 없음 |
| 최근 가입 고객 | `profiles` 최신순 | 없음 |

> **GAP**: 통계 데이터가 하드코딩(0)인 항목 있음. 실제 집계 로직 필요.

---

### 2-2. 고객 관리

| 어드민 조작 | DB 변경 | 사용자 화면 변화 |
|------------|--------|----------------|
| 고객 목록 조회 | `profiles` SELECT | 없음 |
| 고객 검색 (이름/이메일/전화) | `profiles` 필터 | 없음 |
| 가입경로 통계 조회 | `profiles.signup_source` 집계 | 없음 |

> **GAP**: 고객 정보 수정, 고객 직접 메시지, 고객 차단/삭제 기능 없음.

---

### 2-3. PM 관리

| 어드민 조작 | DB 변경 | 사용자 화면 변화 |
|------------|--------|----------------|
| PM 추가 | `project_managers` INSERT | 사용자에게 즉시 영향 없음. 배정 시 적용 |
| PM 프로필 수정 (이름) | `project_managers` UPDATE name | **대시보드**: PM 카드 이름 변경됨 |
| PM 프로필 수정 (사진) | `project_managers` UPDATE profile_image | **대시보드**: PM 카드 사진 변경됨 |
| PM 프로필 수정 (전화) | `project_managers` UPDATE phone | **대시보드**: 전화 버튼 연결 번호 변경 |
| PM 프로필 수정 (소개) | `project_managers` UPDATE introduction | **대시보드**: PM 소개글 변경 |
| PM 프로필 수정 (인사말) | `project_managers` UPDATE greeting_message | 이후 배정되는 프로젝트의 첫 메시지 변경 |
| PM 프로필 수정 (전문분야) | `project_managers` UPDATE specialties | **대시보드**: PM 전문분야 태그 변경 |
| PM 비활성화 | `project_managers` UPDATE is_available=false | 신규 배정 불가. 기존 프로젝트는 유지 |
| PM 삭제 | `project_managers` DELETE | **위험**: 배정된 프로젝트의 PM 정보 사라짐 |

---

### 2-4. 협력업체 관리

| 어드민 조작 | DB 변경 | 사용자 화면 변화 |
|------------|--------|----------------|
| 업체 추가 | `partners` INSERT | 사용자에게 즉시 영향 없음. PM이 배정 시 적용 |
| 업체 수정 | `partners` UPDATE | PM 포털 업체 목록에 반영 |
| 업체 비활성화 | `partners` UPDATE is_active=false | PM 배정 목록에서 제외 |
| 사장님 코멘트 작성 | `partners` UPDATE owner_comment | PM이 견적 보고서 발송 시 사용자에게 노출 |
| 관리자 메모 작성 | `partners` UPDATE admin_memo | 사용자에게 노출 안 됨 (내부 전용) |

---

### 2-5. 프로젝트 관리 (핵심)

#### PM 배정

| 어드민 조작 | DB 변경 | 사용자 화면 변화 |
|------------|--------|----------------|
| "프로젝트 수락" 클릭 | `startup_projects` UPDATE:<br>- pm_id = 선택한 PM<br>- status = 'PM_ASSIGNED'<br>- current_step = 7 | **즉시 변화 (실시간)**:<br>1. 대기 화면 → 대시보드 전환<br>2. PM 프로필 카드 표시<br>3. 시스템 메시지: "담당 매니저가 배정되었습니다"<br>4. PM 인사말 메시지 자동 발송<br>5. 상단 "상담 시작" 파란색 테마 |

**사용자 화면 Before → After:**
```
┌─────────────────┐        ┌─────────────────┐
│                 │        │ ■■□□□□  상담시작  │
│   ⏳ 대기중     │   →    │                 │
│                 │        │ 👤 김민건 매니저  │
│  매니저 배정    │        │ ⭐ 4.9 · 127건   │
│  대기중...      │        │ [📞] [💬채팅]   │
│                 │        │                 │
│  1→2→3→4→5→6   │        │ 💬 첫 상담 진행  │
│  (미래 로드맵)   │        │                 │
└─────────────────┘        └─────────────────┘
```

---

#### 단계 변경

| 단계 변경 | DB 변경 | 사용자 화면 변화 |
|----------|--------|----------------|
| **7→8** (상담→견적) | current_step=8 | 테마: 파랑→**보라**<br>카드: "비용 견적 진행중"<br>안내: "매니저가 견적을 비교하고 있습니다"<br>시스템 메시지 자동 발송<br>토스트 알림 표시 |
| **8→9** (견적→계약) | current_step=9 | 테마: 보라→**주황**<br>카드: "계약금 결제가 필요합니다"<br>**결제 버튼 활성화**<br>"견적 확인 및 결제하기" CTA 표시 |
| **9→10** (계약→시공) | current_step=10 | 테마: 주황→**초록**<br>카드: "시공이 진행되고 있어요"<br>안내: "매니저가 현장을 관리합니다"<br>"시공 진행상황 확인" 버튼 |
| **10→11** (시공→오픈) | current_step=11 | 테마: 초록→**연두**<br>카드: "오픈 준비가 완료되었습니다 🎉"<br>"오픈 체크리스트 확인" 버튼 |
| **11→12** (오픈→사후) | current_step=12 | 테마: 연두→**회색**<br>사후관리 모드 진입 |

**단계 변경 시 공통 동작:**
1. `startup_projects.current_step` 업데이트
2. `project_messages`에 시스템 메시지 INSERT
3. 사용자 대시보드에 토스트 알림 표시
4. 프로그레스 바 업데이트 (n/6)
5. 헤더 그라데이션 색상 변경
6. 단계별 안내 카드 교체

---

#### 메시지 발송

| 어드민 조작 | DB 변경 | 사용자 화면 변화 |
|------------|--------|----------------|
| PM으로 메시지 발송 | `project_messages` INSERT<br>sender_type='PM' | **채팅**: PM 이름으로 메시지 표시<br>**대시보드**: 채팅 미리보기 업데이트<br>실시간 반영 (Supabase Realtime) |
| 시스템으로 메시지 발송 | `project_messages` INSERT<br>sender_type='SYSTEM' | **채팅**: [시스템] 회색 메시지 표시<br>관리자 공지/안내 용도 |

---

### 2-6. 결제 관리

| 어드민이 보는 것 | 데이터 소스 | 사용자 화면과의 관계 |
|----------------|-----------|---------------------|
| 결제 목록 | `payments` 전체 | 사용자가 Step 9에서 결제한 내역 |
| 결제 상태 (대기/완료/실패/환불) | `payments.status` | 사용자 결제 완료 시 → 여기에 표시 |
| 결제 금액 | `payments.amount` | 예상 비용의 10% (계약금) |

> **GAP**: 환불 처리, 결제 취소, 추가 결제 요청 기능 없음.

---

## 3. PM 포털 ↔ 사용자 매핑

### PM이 하는 조작

| PM 조작 | DB 변경 | 사용자 화면 변화 |
|--------|--------|----------------|
| 채팅 메시지 발송 | `project_messages` INSERT (PM) | **채팅**: PM 이름으로 메시지 표시 |
| 체크리스트 항목에 업체 배정 | `project_partner_assignments` INSERT | 사용자에게 직접 보이지 않음.<br>PM이 채팅으로 별도 안내 |
| 비용 보고서 발송 (Step 8) | `project_messages` INSERT<br>(포맷팅된 견적 메시지) | **채팅**: 항목별 업체+가격 정리된 메시지<br>사용자가 확인 후 결제 결정 |
| PM 메모 작성 | `startup_projects.pm_notes` UPDATE | 사용자에게 노출 안 됨 (내부 전용) |

---

## 4. 사용자 조작 → 어드민/PM에 보이는 것

| 사용자 조작 | DB 변경 | 어드민/PM 화면 변화 |
|------------|--------|---------------------|
| 회원가입 | `auth.users` + `profiles` INSERT | **어드민**: 고객 관리 탭에 신규 고객 표시 |
| 위자드 완료 (프로젝트 생성) | `startup_projects` INSERT<br>(status=PENDING_PM) | **어드민**: 프로젝트 탭에 신규 프로젝트 표시<br>"PM 미배정" 상태로 노출<br>PM 배정 드롭다운 활성화 |
| 채팅 메시지 발송 | `project_messages` INSERT (USER) | **PM 포털**: 실시간 메시지 수신<br>**어드민**: 프로젝트 채팅에서 확인 가능 |
| 결제 완료 | `payments` INSERT | **어드민**: 결제 관리 탭에 표시<br>**대시보드**: 시스템 메시지 자동 발송 |
| 이미지 첨부 (채팅) | Supabase Storage + `project_messages` | **PM 포털/어드민**: 이미지 미리보기 표시 |

---

## 5. 데이터 테이블 ↔ 화면 매핑

### startup_projects

| 필드 | 어드민에서 제어 | 사용자 화면 위치 |
|------|---------------|-----------------|
| business_category | 조회만 | 대시보드 헤더, PM 카드, 결제 모달 |
| location_dong | 조회만 | 대시보드 프로젝트 카드 |
| store_size | 조회만 | 대시보드 프로젝트 카드 |
| estimated_total | 조회만 | 대시보드 비용 표시, 결제 모달 금액 |
| current_step | **단계 드롭다운** | 대시보드 전체 테마/색상/카드/프로그레스 |
| status | PM 배정 시 자동 변경 | 대기 화면 vs 대시보드 분기 |
| pm_id | **PM 배정 드롭다운** | PM 프로필 카드 전체 |
| checklist_data | 조회만 | 위자드 5단계 체크리스트 |

### project_managers

| 필드 | 어드민에서 제어 | 사용자 화면 위치 |
|------|---------------|-----------------|
| name | **수정 가능** | 대시보드 PM 카드, 채팅 발신자명 |
| phone | **수정 가능** | 대시보드 전화 버튼 (confirm 팝업 후 발신) |
| profile_image | **수정 가능** | 대시보드 PM 프로필 이미지 |
| introduction | **수정 가능** | 대시보드 PM 소개글 |
| greeting_message | **수정 가능** | 최초 배정 시 채팅 첫 메시지 |
| specialties | **수정 가능** | 대시보드 PM 태그 |
| rating | **수정 가능** | 대시보드 PM 카드 "⭐ 4.9" |
| completed_projects | **수정 가능** | 대시보드 PM 카드 "127건 완료" |

### project_messages

| 필드 | 누가 생성 | 사용자 화면 위치 |
|------|----------|-----------------|
| sender_type=USER | 사용자 | 채팅 오른쪽 (파란 말풍선) |
| sender_type=PM | PM 또는 어드민 | 채팅 왼쪽 (흰 말풍선, PM 이름 표시) |
| sender_type=SYSTEM | 어드민 또는 자동 | 채팅 중앙 (회색 배경, "시스템") |
| attachments | 사용자 (이미지) | 채팅 이미지 미리보기 |

---

## 6. 단계별 사용자 경험 상세

### Step 7: 상담 시작 (파랑 #3B82F6)

```
사용자가 보는 것                    어드민/PM이 해야 할 것
──────────────────────────────────────────────────
[파란 헤더] 상담 시작 1/6          PM 배정 완료 상태
[PM 프로필 카드]                   PM 프로필 관리에서 정보 완비
  김민건 매니저
  ⭐ 4.9 · 127건 완료
  [📞 전화] [💬 채팅]

[안내 카드]
  "매니저와 첫 상담 진행중"         PM이 채팅으로 응대
  "궁금한 점을 물어보세요"
  [매니저에게 메시지 보내기]

[진행 단계]
  ●상담 ○견적 ○계약 ○시공 ○오픈 ○관리
```

**PM 할 일**: 사용자 질문에 채팅 응답, 업종/지역 상담
**어드민 할 일**: 상담 충분히 진행되면 단계를 8로 변경

---

### Step 8: 비용 견적 (보라 #8B5CF6)

```
사용자가 보는 것                    어드민/PM이 해야 할 것
──────────────────────────────────────────────────
[보라 헤더] 비용 견적 2/6          어드민이 7→8 단계 변경

[안내 카드]                        PM이 협력업체 견적 비교중
  "비용 견적 진행중"
  "매니저가 견적을 비교중"          PM 포털에서 업체 배정
  [매니저에게 문의하기]             PM이 비용 보고서 발송
```

**PM 할 일**: 체크리스트 항목별 협력업체 배정, 견적 비교, 비용 보고서 채팅 발송
**어드민 할 일**: 견적 확정 후 단계를 9로 변경

---

### Step 9: 계약/시작 (주황 #F97316)

```
사용자가 보는 것                    어드민/PM이 해야 할 것
──────────────────────────────────────────────────
[주황 헤더] 계약/시작 3/6          어드민이 8→9 단계 변경

[안내 카드]
  "계약금 결제가 필요합니다"        사용자 결제를 기다림
  "계약금을 결제하시면 시공 시작"
  [견적 확인 및 결제하기] ←── CTA

[결제 모달 - 4단계]
  1. 견적 확인 (예상비용 10%)
  2. 결제수단 선택
  3. 최종 확인
  4. 완료 → 시스템 메시지 발송     결제 완료 → 어드민 결제 탭에 표시
```

**사용자 할 일**: 결제 모달에서 계약금 결제
**어드민 할 일**: 결제 확인 후 단계를 10으로 변경

---

### Step 10: 시공 진행 (초록 #10B981)

```
사용자가 보는 것                    어드민/PM이 해야 할 것
──────────────────────────────────────────────────
[초록 헤더] 시공 진행 4/6          어드민이 9→10 단계 변경

[안내 카드]
  "시공이 진행되고 있어요"          PM이 현장 사진 공유
  "매니저가 현장을 관리합니다"      PM이 진행상황 채팅 업데이트
  [시공 진행상황 확인]
```

**PM 할 일**: 현장 사진 촬영 후 채팅 공유, 진행상황 업데이트
**어드민 할 일**: 시공 완료 시 단계를 11로 변경

---

### Step 11: 오픈 완료 (연두 #22C55E)

```
사용자가 보는 것                    어드민/PM이 해야 할 것
──────────────────────────────────────────────────
[연두 헤더] 오픈 완료 5/6          어드민이 10→11 단계 변경

[안내 카드]
  "오픈 준비가 완료되었습니다 🎉"    PM이 최종 체크리스트 안내
  "영업신고, 위생교육 등 확인"
  [오픈 체크리스트 확인]
```

**PM 할 일**: 오픈 체크리스트 안내, 해피콜
**어드민 할 일**: 사후관리 전환 시 단계를 12로 변경

---

### Step 12: 사후관리 (회색 #64748B)

```
사용자가 보는 것                    어드민/PM이 해야 할 것
──────────────────────────────────────────────────
[회색 헤더] 사후관리 6/6           어드민이 11→12 단계 변경

  프로젝트 완료 상태               PM이 필요시 해피콜
  채팅은 계속 가능                  추가 문의 응대
```

---

## 7. 실시간 연동 (Supabase Realtime)

| 테이블 | 이벤트 | 구독자 | 효과 |
|--------|--------|--------|------|
| `startup_projects` | UPDATE | 사용자 대시보드 | 단계 변경/PM 배정 즉시 반영 |
| `project_messages` | INSERT | 사용자 채팅 | 새 메시지 실시간 수신 |
| `project_messages` | INSERT | PM 포털 | 사용자 메시지 실시간 수신 |

---

## 8. 현재 미구현 (어드민 → 사용자 제어 GAP)

### 해결됨 (2026-02-07)

| 항목 | 해결 방법 |
|------|----------|
| ~~단계 전환 규칙 없음~~ | 어드민: 2단계 점프 시 confirm, Step 9→10 결제 확인. PM: 역행 차단, 점프 경고 |
| ~~결제 후 수동 전환~~ | 결제 완료 시 자동 Step 9→10 전환 (게스트 포함) |
| ~~신규 프로젝트 알림 없음~~ | Realtime 구독 + 프로젝트 탭 빨간 뱃지 + PENDING_PM 개수 표시 |
| ~~PM 산출물 미정의~~ | STEP_REQUIREMENTS 체크리스트 (메시지/업체배정/보고서/해피콜) + 미충족 시 경고 |
| ~~단계 역행 불가~~ | 어드민은 역행 허용 (confirm 경고). PM은 역행 차단, 어드민에게 요청 안내 |

### 높은 우선순위

| GAP | 설명 | 사용자 영향 |
|-----|------|-----------|
| 프로젝트 취소/환불 | 어드민에서 프로젝트 취소 불가 | 사용자가 취소 요청 시 대응 불가 |
| 고객 직접 메시지 | 어드민이 고객에게 직접 연락 불가 | PM 미배정 상태에서 안내 불가 |
| 결제 환불 처리 | 결제 취소/환불 기능 없음 | 분쟁 시 처리 불가 |
| 알림 발송 | 푸시/SMS 알림 없음 | 사용자가 앱을 열어야만 변경사항 확인 |

### 중간 우선순위

| GAP | 설명 | 사용자 영향 |
|-----|------|-----------|
| 매출 통계 | 실제 집계 없음 (0 하드코딩) | 어드민 의사결정 제약 |
| PM 성과 분석 | PM별 완료율/평점 집계 없음 | PM 배정 최적화 불가 |
| 고객 정보 수정 | 프로필 수정 불가 | 고객 정보 오류 시 대응 불가 |
| 자동 PM 배정 | 업종/지역 기반 자동 매칭 없음 | 수동 배정으로 지연 |
| 문서 관리 | 계약서/견적서 업로드 없음 | 채팅으로만 문서 공유 |

### 낮은 우선순위

| GAP | 설명 |
|-----|------|
| 대량 작업 | 일괄 PM 배정, 일괄 메시지 발송 |
| 예약 메시지 | 특정 시간에 자동 발송 |
| 고객 세그먼트 | 업종/지역/예산별 그룹 분류 |
| A/B 테스트 | PM/업체 조합 실험 |
| 프로젝트 템플릿 | 업종별 표준 견적/체크리스트 |

---

## 9. 화면 파일 매핑

| 사용자 화면 | 파일 | 어드민 제어 파일 |
|------------|------|-----------------|
| 랜딩 | `components/LandingView.tsx` | 없음 |
| 로그인/회원가입 | `components/LoginView.tsx` | 없음 |
| 온보딩 슬라이드 | `components/ServiceJourneyView.tsx` (L793~) | 없음 |
| 위자드 1~6단계 | `components/ServiceJourneyView.tsx` | 없음 |
| 대시보드 (대기) | `components/DashboardView.tsx` (L611~) | `components/AdminView.tsx` (PM 배정) |
| 대시보드 (진행) | `components/DashboardView.tsx` (L709~) | `components/AdminView.tsx` (단계 변경) |
| 채팅 | `components/DashboardView.tsx` (L305~) | `components/AdminView.tsx` (메시지) |
| 결제 모달 | `components/DashboardView.tsx` (L414~) | `components/AdminView.tsx` (결제 조회) |
| 하단 네비게이션 | `components/BottomNav.tsx` | 없음 |
| 더보기 | `components/MoreView.tsx` | 없음 |
| 마이페이지 | `components/MyPageView.tsx` | 없음 |
| - | - | `components/AdminView.tsx` (어드민 전체) |
| - | - | `components/PMPortalView.tsx` (PM 전용) |

---

## 10. 체크리스트: 새 기능 추가 시

새로운 어드민 기능을 추가할 때 반드시 확인:

- [ ] 어드민 조작 시 DB 어떤 테이블/필드가 변경되는가?
- [ ] 해당 DB 변경이 사용자 화면 어디에 반영되는가?
- [ ] 실시간 반영이 필요한가? (Supabase Realtime 구독 필요?)
- [ ] 사용자에게 알림/메시지가 필요한가?
- [ ] 사용자 화면 상태(테마, 텍스트, 버튼)가 바뀌는가?
- [ ] 이 문서(ADMIN_UX_MAP.md)에 매핑을 기록했는가?
